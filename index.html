<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>ãƒ•ã‚©ãƒ«ãƒ€å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»ãƒ•ã‚©ãƒ«ãƒ€åä¸€è¦§</title>
    <style>
      #drop-zone {
        width: 100%;
        padding: 50px;
        border: 2px dashed #888;
        text-align: center;
        margin-top: 30px;
        background-color: #fafafa;
      }
      #controls {
        margin-top: 20px;
      }
      #search {
        padding: 5px;
        width: 250px;
      }
      #output {
        margin-top: 20px;
        background: #f0f0f0;
        padding: 10px;
        border: 1px solid #ccc;
        max-height: 400px;
        overflow-y: auto;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th, td {
        border: 1px solid #bbb;
        padding: 5px;
        text-align: left;
      }
      th {
        background: #ddd;
      }
    </style>
  </head>
  <body>
    <h2>ğŸ“‚ ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ‰ãƒ©ãƒƒã‚°ï¼†ãƒ‰ãƒ­ãƒƒãƒ— â†’ ç›´ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«åãƒ»ãƒ•ã‚©ãƒ«ãƒ€åã‚’è¡¨ç¤º</h2>
    <div id="drop-zone">ã“ã“ã«ãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ‰ãƒ­ãƒƒãƒ—</div>

    <div id="controls">
      <input type="text" id="search" placeholder="æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›..." />
      <button onclick="copyOutput()">ã‚³ãƒ”ãƒ¼</button>
    </div>

    <div id="output">ã“ã“ã«çµæœãŒè¡¨ç¤ºã•ã‚Œã¾ã™</div>

    <script>
      const dropZone = document.getElementById("drop-zone");
      const output = document.getElementById("output");
      const searchBox = document.getElementById("search");
      let allNames = []; // å…¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€åã‚’ä¿æŒ

      dropZone.addEventListener("dragover", (event) => {
        event.preventDefault();
        dropZone.style.backgroundColor = "#e0f7fa";
      });
      dropZone.addEventListener("dragleave", () => {
        dropZone.style.backgroundColor = "#fafafa";
      });
      dropZone.addEventListener("drop", async (event) => {
        event.preventDefault();
        dropZone.style.backgroundColor = "#fafafa";
        output.textContent = "èª­ã¿è¾¼ã¿ä¸­...";
        allNames = [];
        const items = event.dataTransfer.items;
        const promises = [];
        for (const item of items) {
          const entry = item.webkitGetAsEntry?.();
          if (entry && entry.isDirectory) {
            promises.push(readTopLevelEntries(entry));
          }
        }
        await Promise.all(promises);
        renderTable(allNames);
      });

      // ãƒ•ã‚©ãƒ«ãƒ€ç›´ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»ãƒ•ã‚©ãƒ«ãƒ€ã ã‘èª­ã‚€
      async function readTopLevelEntries(directoryEntry) {
        const reader = directoryEntry.createReader();
        return new Promise((resolve) => {
          reader.readEntries((entries) => {
            for (const ent of entries) {
              if (ent.name.startsWith(".")) continue; // éš ã—ãƒ•ã‚¡ã‚¤ãƒ«é™¤å¤–
              allNames.push({
                name: ent.name,
                type: ent.isDirectory ? "ãƒ•ã‚©ãƒ«ãƒ€" : "ãƒ•ã‚¡ã‚¤ãƒ«",
              });
            }
            resolve();
          });
        });
      }

      // ãƒ†ãƒ¼ãƒ–ãƒ«æç”»
      function renderTable(data) {
        if (data.length === 0) {
          output.textContent = "ãƒ•ã‚¡ã‚¤ãƒ«ã‚„ãƒ•ã‚©ãƒ«ãƒ€ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚";
          return;
        }
        const filtered = data.filter((item) =>
          item.name.toLowerCase().includes(searchBox.value.toLowerCase())
        );
        let html = "<table><tr><th>åå‰</th><th>ç¨®é¡</th></tr>";
        for (const item of filtered) {
          html += `<tr><td>${item.name}</td><td>${item.type}</td></tr>`;
        }
        html += "</table>";
        output.innerHTML = html;
      }

      // æ¤œç´¢ã‚¤ãƒ™ãƒ³ãƒˆ
      searchBox.addEventListener("input", () => {
        renderTable(allNames);
      });

      // ã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ï¼ˆãƒ†ã‚­ã‚¹ãƒˆã¨ã—ã¦ã‚³ãƒ”ãƒ¼ï¼‰
      function copyOutput() {
        const text = allNames
          .map((item) => item.name)
          .sort()
          .join("\n");
        navigator.clipboard.writeText(text).then(() => {
          alert("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
        });
      }
    </script>
  </body>
</html>
